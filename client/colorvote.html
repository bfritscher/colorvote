<head>
	<meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="description" content="Realtime voting with color cards" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-title" content="ColorVote" />
	<link rel="icon"  type="image/x-icon" href="favicon.ico" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png" />
	<title>ColorVote</title>
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css' />
	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44448840-1');
  ga('send', 'pageview');
</script>
<script src="http://www.bugsense.com/static/js/global/bugsense.js" type='text/javascript'></script>
<script type="text/javascript">
	var bugsense = new Bugsense( { apiKey: 'b3ee2450' } );

	Meteor._debug = function () {
	  var e = new Error();
	  e.name = "MeteorError";
	  e.message = Array.prototype.join.call(arguments, " ");
	  e.stack = e.message;
	  bugsense.notify(e, {'serverId': __meteor_runtime_config__.serverId});
	};
</script>
</head>

<body>
	<div class="wrapper">
	{{> page}}
	</div>
</body>

<template name="debug">
<div>{{time}}</div>
</template>

<template name="page">
  {{#if session 'showlogin'}}
	{{loginButtons align="right"}}
  {{/if}}
  {{#if currentPageIs 'roomSelection'}}
	{{> roomSelection}}	
  {{/if}}
  {{#if currentPageIs 'roomVoter'}}
	{{> roomVoter}}	
  {{/if}}
  {{#if currentPageIs 'roomAsker'}}
	{{> roomAsker}}	
  {{/if}}
</template>

<template name="logo">
<div>
  <h1 class="logo">ColorVote</h1>
  <div id="logo">
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
	<div></div>
  </div>
</div>  
</template>

<template name="roomSelection">
	{{> logo}}
	<div class="rooms">
	{{#each rooms}}
		{{> roomSelectionItem}}
	{{/each}}
	{{#isolate}}
		{{#if isAdmin}}
			<div class="room add-room">+ Add room</div>
		{{/if}}
	{{/isolate}}
  </div>
</template>
<template name="roomSelectionItem">
  <div class="room">{{name}} {{> roomCount this}}
  {{#isolate}}
	{{#if isAdmin}}<span class="rename-room">renommer</span>{{/if}}
  {{/isolate}}
  </div>
</template>
<template name="roomCount">
	<span>({{count}})</span>
</template>
<template name="roomName">
  <div class="room-title">{{room}}</div>
  {{#isolate}}
  <div class="room-stats">{{votes}}<br/><span>{{presenceCount}}</span></div>
  {{/isolate}}
</template>
<template name="roomVoter">
{{>swipeVote}}
{{> roomName}}
{{#isolate}}
<div class="show-card-vote"></div>
{{#if session 'showCardVote'}}
<div class="card-vote">
{{#each choices}}
	{{> choice}}
{{/each}}
</div>
{{/if}}
{{/isolate}}
{{#isolate}}
	{{#if votenow}}
	<div class="votenow">Votez maintenant</div>
	{{/if}}
{{/isolate}}
{{#isolate}}
	{{#if stopped}}
	<div class="voting-stopped">
	<h1>Votation terminée</h1>
	</div>
	{{/if}}
{{/isolate}}
{{>backLink}}
</template>

<template name="swipeVote">
{{#constant}}
<div class="swiper-container voter">
	<div class="swiper-wrapper">
		<div class="swiper-slide"><div class="title"></div></div>
		<div class="swiper-slide"><div class="title"></div></div>
		<div class="swiper-slide"><div class="title"></div></div>
	</div>
	<div class="pagination"></div>
</div>
{{/constant}}
</template>

<template name="backLink">
	<div class="backLink"><</div>
</template>

<template name="choice">
	<div class="card-wrapper"><div class="card color-{{no}} {{#if currentVoteIs no}}active{{/if}}"><div class="title">{{no}}</div></div></div>
</template>

<template name="roomAsker">
	{{> logo}}
	{{> roomName}}
	<div id="voting-admin-panel">
		{{>timer}}
		
		{{> questionAction}}
	
		votes: {{>votesCount}}
		<div id="showqrcode" title="afficher le QRCode">{{> qrCode hrefThumb}}</div>
		<img id="toggleHistory" alt="afficher historique" title="afficher historique"  src="/history_icon.png"/>
		<img id="toggleResults" alt="afficher résultats" title="afficher résultats"  src="/chart_icon.png"/>
		{{>backLink}}
	</div>
	{{#if session 'showresults'}}
	<div class="liveresults">
		{{#isolate}}
		{{> resultChart data}}
		{{/isolate}}
		{{#unless stopped}}
		<div>
			<label>nombres de choix <input type="range" min="2" max="{{Config.numMaxAnswers}}" value="{{possibleAnswers}}" /></label>
		</div>
		{{/unless}}
	</div>
	{{/if}}
	{{#if session 'showqrcode'}}
		<div id="qrCodePanel">
			{{> qrCode href}}
			<h1>{{href.href}}</h1>
		</div>
	{{/if}}
	{{> history}}
</template>
<template name="questionAction">
	{{#if stopped}}<button id="questionAction" class="new">NOUVEAU</button>{{/if}}
	{{#unless stopped}}<button id="questionAction" class="stop">TERMINER</button>{{/unless}}
</template>
<template name="votesCount">
<span class="votesCount">{{votesCount}}</span>
</template>
<template name="timer">
<span class="timer">{{session 'elapsedTime'}}</span>
</template>
<template name="history">
{{#if session 'showhistory'}}
<div class="history">
<div class="swiper-container">
	<div class="swiper-wrapper preload">
	{{#each questionsHistory}}
		<div class="swiper-slide questionHistory">
			{{> resultChart results}}
			<div class="chart-info">&#916; {{time}} <span class="date">&#64; {{date}}</span><span class="count">N {{votes}}</span></div>
		</div>
	{{/each}}
	</div>
	<div class="pagination"></div>
</div>	
</div>
{{/if}}
</template>
<template name="resultChart">
    {{#constant}}
      <svg width="500" height="500" class="chart">
		<g class="transform">
			<g class="x axis"></g>
			<g class="y axis"></g>
		</g>
      </svg>
    {{/constant}}
</template>
<template name="qrCode">
    {{#constant}}
	<div class="qrcode"></div>
	{{/constant}}
</template>